---
layout: page
title: Threat Actor Leveraging Attack Patterns and Malware
categories: examples
---

A large part of the reason for doing threat actor attribution and correlation is to develop an understanding of the adversary behavior in order to better prioritize courses of action and defend against those types of attacks. In many cases, adversary behavior can be characterized by the types of attack patterns they typically use: for example, using spear phishing as a delivery mechanism for malware is an attack pattern. In other cases, behavior can be described based on the malware that the adversary typically uses.

**Scenario**
------------

This scenario represents a threat actor known as “Adversary Bravo”. Adversary Bravo is known to use phishing attacks to deliver remote access malware to the targets. The malware variety they typically use is a variant on the Poison Ivy malware.

**Data model**
--------------

Any known characteristics and attributes of Adversary Bravo can be modeled using the [Threat Actor](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_k017w16zutw) STIX Domain Object (SDO). This object captures information specific to the threat actor, such as other aliases, motivations for attacking, and roles they may have in an attack. Sometimes this information is not fully known, which is the case for Adversary Bravo. Therefore, you only need to specify required properties for the Threat Actor object which consist of a <span class="sdo">**name**</span> and a list of <span class="sdo">**threat_actor_types**</span>. The <span class="sdo">**threat_actor_types**</span> field categorizes the type of threat actor based on the [threat-actor-type](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_tqbl8z36yoir) vocabulary. In this instance we can infer that by using Poison Ivy malware to establish a remote backdoor, Adversary Bravo may be performing nefarious activity or spying which results in types of <span class="values">criminal</span> and <span class="values">spy</span>.

Other basic identifying information about Adversary Bravo is captured with an [Identity](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_wh296fiwpklp) SDO. In this scenario, this object is used for a threat actor identity, but it can also represent organizations, governments, and other entities. It is useful for capturing sectors this Identity may be affiliated with as well as relevant contact information. In the case of Adversary Bravo, there is little information about this identity, so the required <span class="sdo">**identity\_class**</span> property, based on the [identity class](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_be1dktvcmyu) vocabulary, would be <span class="values">unknown</span>. The Identity SDO can be linked with the Threat Actor SDO by using a [Relationship object](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_e2e1szrqfoan). The type of relationship between the 2 objects, represented by the <span class="sdo">**relationship\_type**</span> field, would contain a value of <span class="values">attributed-to</span>, meaning this threat actor is attributed to this identity.

The malware in this scenario is a Poison Ivy variant d1c6 which can be represented using a [Malware](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_s5l7katgbp09) SDO. It is required for every Malware object to incorporate a list of <span class="sdo">**malware types**</span> to describe the malware. Since this is a type of remote trojan, the <span class="sdo">**malware_types**</span> property would contain the value <span class="values">remote-access-trojan</span> which comes from the [malware type](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_oxlc4df65spl) vocabulary. You can label malware objects with more than one value however, as some may likely have more than one capability. For instance, a particular type of malware could be both a keylogger and spyware. Another relationship can be established between this Malware SDO and the Threat Actor SDO. In this case, the <span class="sdo">**relationship\_type**</span> between the two objects would be <span class="values">uses</span>. The Threat Actor <span class="values">uses</span> the Malware.

Adversary Bravo uses phishing as a delivery mechanism for the Poison Ivy malware which can be represented using an [Attack Pattern](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_axjijf603msy) SDO. In addition to providing more context about what the threat actor is trying to do, Attack Pattern objects are useful for representing taxonomies such as CAPEC with the <span class="sdo">**external\_references**</span> field. [*Common Attack Pattern Enumeration and Classification (CAPEC™)*](http://capec.mitre.org/) is a dictionary of potential attack patterns, so in this case by looking in that dictionary the producer could see that “CAPEC-98” is the ID for phishing and can label the <span class="sdo">**external\_id**</span> as such. A Relationship SRO once again links the Threat Actor to this Attack Pattern object with a <span class="sdo">**relationship\_type**</span> of <span class="values">uses</span>.

One other useful concept that is seen in both the Malware and Attack Pattern objects is the ability to capture [kill chain](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_i4tjv75ce50h) information. For instance, certain attack patterns, malware, and tools might be used to establish a foothold or move laterally once a system has been compromised. In this example, the Poison Ivy malware and phishing attack pattern are associated with the kill chain phase <span class="values">initial-compromise</span>, since the threat actor is attempting to establish an initial backdoor with the Poison Ivy variant. This phase is from the Mandiant Attack Lifecycle Model, but you are not limited to using any specific type of kill chain.

A diagram below shows the objects used in this scenario [(An interactive version can be found here)](https://oasis-open.github.io/cti-stix-visualization/?url=https://raw.githubusercontent.com/oasis-open/cti-documentation/master/examples/example_json/threat-actor-leveraging-attack-patterns-and-malware.json){: target="_blank"}:

![Threat Actor leveraging attack patterns and malware]({{ site.baseurl }}/img/ThreatActorLeveragingAttackPatternsandMalware.PNG)

**Further Reading**
-------------------

To read more about the objects in this example as well as common properties and vocabularies, check out the links below:

-   [Common Properties](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_xzbicbtscatx)
-   [Vocabularies](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_izngjy1g98l2)
-   [Threat Actor](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_k017w16zutw)
-   [Identity](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_wh296fiwpklp)
-   [Attack Pattern](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_axjijf603msy)
-   [Malware](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_s5l7katgbp09)
-   [Relationship](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_e2e1szrqfoan)
-   [Kill Chain Phase](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_i4tjv75ce50h)

**Implementation**
------------------

{% include start_tabs.html tabs="JSON|Python Producer|Python Consumer" name="ta-leveraging-ap" %}{% highlight json linenos %}
{% include_relative example_json/threat-actor-leveraging-attack-patterns-and-malware.json %}
{% endhighlight %}{% include tab_separator.html %}{% highlight python linenos %}
{% include_relative producer_python/threat-actor-leveraging-attack-patterns-and-malware-producer.py %}
{% endhighlight %}{% include tab_separator.html %}{% highlight python linenos %}
{% include_relative consumer_python/threat-actor-leveraging-attack-patterns-and-malware-consumer.py %}
{% endhighlight %}{% include tab_separator.html %}{% highlight python linenos %}
{% endhighlight %}{% include end_tabs.html %}
